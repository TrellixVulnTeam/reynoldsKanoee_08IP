{"version":3,"file":"moltin.cjs.js","sources":["../src/config.js","../src/factories/storage.js","../node_modules/uuid/lib/rng-browser.js","../node_modules/uuid/lib/bytesToUuid.js","../node_modules/uuid/v4.js","../src/utils/helpers.js","../src/factories/request.js","../src/extends/base.js","../src/extends/catalogue.js","../src/endpoints/products.js","../src/endpoints/currencies.js","../src/endpoints/brands.js","../src/endpoints/cart.js","../src/endpoints/categories.js","../src/endpoints/collections.js","../src/endpoints/orders.js","../src/endpoints/gateways.js","../src/endpoints/customers.js","../src/moltin.js"],"sourcesContent":["import { version } from '../package.json';\n\nclass Config {\n  constructor(options) {\n    const { application, client_id, client_secret, currency, host } = options;\n\n    this.application = application;\n    this.client_id = client_id;\n    this.client_secret = client_secret;\n    this.host = host || 'api.moltin.com';\n    this.protocol = 'https';\n    this.version = 'v2';\n    this.currency = currency;\n    this.auth = {\n      expires: 3600,\n      uri: 'oauth/access_token',\n    };\n    this.sdk = {\n      version,\n      language: 'JS',\n    };\n  }\n}\n\nexport default Config;\n","/* eslint no-undef: \"off\",\n          global-require: \"off\"\n*/\n\nclass StorageFactory {\n  constructor() {\n    if (typeof localStorage === 'undefined' || localStorage === null) {\n      const LocalStorage = require('node-localstorage').LocalStorage;\n\n      this.localStorage = new LocalStorage('./localStorage');\n    } else {\n      this.localStorage = window.localStorage;\n    }\n  }\n\n  set(key, value) {\n    return this.localStorage.setItem(key, value);\n  }\n\n  get(key) {\n    return this.localStorage.getItem(key);\n  }\n\n  delete(key) {\n    return this.localStorage.removeItem(key);\n  }\n}\n\nexport default StorageFactory;\n","// Unique ID creation requires a high quality random # generator.  In the\n// browser this is a little complicated due to unknown quality of Math.random()\n// and inconsistent support for the `crypto` API.  We do the best we can via\n// feature-detection\nvar rng;\n\nvar crypto = global.crypto || global.msCrypto; // for IE 11\nif (crypto && crypto.getRandomValues) {\n  // WHATWG crypto RNG - http://wiki.whatwg.org/wiki/Crypto\n  var rnds8 = new Uint8Array(16); // eslint-disable-line no-undef\n  rng = function whatwgRNG() {\n    crypto.getRandomValues(rnds8);\n    return rnds8;\n  };\n}\n\nif (!rng) {\n  // Math.random()-based (RNG)\n  //\n  // If all else fails, use Math.random().  It's fast, but is of unspecified\n  // quality.\n  var rnds = new Array(16);\n  rng = function() {\n    for (var i = 0, r; i < 16; i++) {\n      if ((i & 0x03) === 0) r = Math.random() * 0x100000000;\n      rnds[i] = r >>> ((i & 0x03) << 3) & 0xff;\n    }\n\n    return rnds;\n  };\n}\n\nmodule.exports = rng;\n","/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\nvar byteToHex = [];\nfor (var i = 0; i < 256; ++i) {\n  byteToHex[i] = (i + 0x100).toString(16).substr(1);\n}\n\nfunction bytesToUuid(buf, offset) {\n  var i = offset || 0;\n  var bth = byteToHex;\n  return bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]];\n}\n\nmodule.exports = bytesToUuid;\n","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\nfunction v4(options, buf, offset) {\n  var i = buf && offset || 0;\n\n  if (typeof(options) == 'string') {\n    buf = options == 'binary' ? new Array(16) : null;\n    options = null;\n  }\n  options = options || {};\n\n  var rnds = options.random || (options.rng || rng)();\n\n  // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n  rnds[6] = (rnds[6] & 0x0f) | 0x40;\n  rnds[8] = (rnds[8] & 0x3f) | 0x80;\n\n  // Copy bytes to buffer, if provided\n  if (buf) {\n    for (var ii = 0; ii < 16; ++ii) {\n      buf[i + ii] = rnds[ii];\n    }\n  }\n\n  return buf || bytesToUuid(rnds);\n}\n\nmodule.exports = v4;\n","import uuidv4 from 'uuid/v4';\nimport StorageFactory from '../factories/storage';\n\nexport function buildRelationshipData(type, ids) {\n  let data = [];\n\n  if (ids === null || ids.length === 0) {\n    return [];\n  }\n\n  if (typeof ids === 'string') {\n    return [{\n      type,\n      id: ids,\n    }];\n  }\n\n  if (Array.isArray(ids)) {\n    data = ids.map(id => ({\n      type,\n      id,\n    }));\n  }\n\n  return data;\n}\n\nexport function cartIdentifier() {\n  const storage = new StorageFactory();\n  const cartId = uuidv4();\n\n  if (storage.get('mcart') !== null) {\n    return storage.get('mcart');\n  }\n\n  storage.set('mcart', cartId);\n\n  return cartId;\n}\n\nexport function parseJSON(response) {\n  if (response.status === 204) {\n    return new Promise((resolve) => {\n      resolve({\n        status: response.status,\n        ok: response.ok,\n        json: '{}',\n      });\n    });\n  }\n\n  return new Promise(resolve => response.json()\n  .then(json => resolve({\n    status: response.status,\n    ok: response.ok,\n    json,\n  })));\n}\n\nfunction formatFilterString(type, filter) {\n  const filterStringArray = Object.keys(filter).map((key) => {\n    const value = filter[key];\n\n    return `${type}(${key},${value})`;\n  });\n\n  return filterStringArray.join(':');\n}\n\nfunction formatQueryString(key, value) {\n  if (key === 'limit' || key === 'offset') {\n    return `page${(value)}`;\n  }\n\n  if (key === 'filter') {\n    const filterValues = Object.keys(value).map(\n      filter => formatFilterString(filter, value[filter]));\n\n    return `${key}=${filterValues.join(':')}`;\n  }\n\n  return `${key}=${value}`;\n}\n\nfunction buildQueryParams({ includes, sort, limit, offset, filter }) {\n  const query = {};\n\n  if (includes) {\n    query.include = includes;\n  }\n\n  if (sort) {\n    query.sort = `(${sort})`;\n  }\n\n  if (limit) {\n    query.limit = `[limit]=${limit}`;\n  }\n\n  if (offset) {\n    query.offset = `[offset]=${offset}`;\n  }\n\n  if (filter) {\n    query.filter = filter;\n  }\n\n  return Object.keys(query).map(k => formatQueryString(k, query[k])).join('&');\n}\n\nexport function buildURL(endpoint, params) {\n  if (params.includes || params.sort || params.limit || params.offset || params.filter) {\n    const paramsString = buildQueryParams(params);\n\n    return `${endpoint}?${paramsString}`;\n  }\n\n  return endpoint;\n}\n\nexport function buildRequestBody(body) {\n  let parsedBody;\n\n  if (body) {\n    parsedBody = `{\n      \"data\": ${JSON.stringify(body)}\n    }`;\n  }\n\n  return parsedBody;\n}\n\nexport function buildCartItemData(id, quantity = null, type = 'cart_item') {\n  const payload = {\n    type,\n  };\n\n  if (type === 'cart_item') {\n    Object.assign(payload, {\n      id,\n      quantity: parseInt(quantity, 10),\n    });\n  }\n\n  if (type === 'promotion_item') {\n    Object.assign(payload, {\n      code: id,\n    });\n  }\n\n  return payload;\n}\n\nexport function buildCartCheckoutData(customer, billing_address, shipping_address) {\n  let parsedCustomer = customer;\n\n  if (typeof customer === 'string') parsedCustomer = { id: customer };\n\n  return {\n    customer: parsedCustomer,\n    billing_address,\n    shipping_address,\n  };\n}\n","import StorageFactory from './storage';\nimport { buildRequestBody, parseJSON } from '../utils/helpers';\n\nclass RequestFactory {\n  constructor(config) {\n    this.config = config;\n\n    this.storage = new StorageFactory();\n  }\n\n  authenticate() {\n    const { config, storage } = this;\n\n    if (!config.client_id) {\n      throw new Error('You must have a client_id set');\n    }\n\n    if (!config.host) {\n      throw new Error('You have not specified an API host');\n    }\n\n    const body = {\n      grant_type: config.client_secret ? 'client_credentials' : 'implicit',\n      client_id: config.client_id,\n    };\n\n    if (config.client_secret) {\n      body.client_secret = config.client_secret;\n    }\n\n    const promise = new Promise((resolve, reject) => {\n      fetch(`${config.protocol}://${config.host}/${config.auth.uri}`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/x-www-form-urlencoded',\n        },\n        body: Object.keys(body).map(k => `${encodeURIComponent(k)}=${encodeURIComponent(body[k])}`).join('&'),\n      })\n      .then(parseJSON)\n      .then((response) => {\n        if (response.ok) {\n          resolve(response.json);\n        }\n\n        reject(response.json);\n      })\n      .catch(error => reject(error));\n    });\n\n    promise.then((response) => {\n      storage.set('mtoken', response.access_token);\n      storage.set('mexpires', response.expires);\n    });\n\n    return promise;\n  }\n\n  send(uri, method, body = undefined, token = undefined) {\n    const { config, storage } = this;\n\n    const promise = new Promise((resolve, reject) => {\n      const req = () => {\n        const headers = {\n          Authorization: `Bearer: ${storage.get('mtoken')}`,\n          'Content-Type': 'application/json',\n          'X-MOLTIN-SDK-LANGUAGE': config.sdk.language,\n          'X-MOLTIN-SDK-VERSION': config.sdk.version,\n        };\n\n        if (config.application) {\n          headers['X-MOLTIN-APPLICATION'] = config.application;\n        }\n\n        if (config.currency) {\n          headers['X-MOLTIN-CURRENCY'] = config.currency;\n        }\n\n        if (token) {\n          headers['X-MOLTIN-CUSTOMER-TOKEN'] = token;\n        }\n\n        /* eslint no-undef: \"off\" */\n        fetch(`${config.protocol}://${config.host}/${config.version}/${uri}`, {\n          method: method.toUpperCase(),\n          headers,\n          body: buildRequestBody(body),\n        })\n        .then(parseJSON)\n        .then((response) => {\n          if (response.ok) {\n            resolve(response.json);\n          }\n\n          reject(response.json);\n        })\n        .catch(error => reject(error));\n      };\n\n      if (!storage.get('mtoken') || Date.now().toString() >= storage.get('mexpires')) {\n        return this.authenticate()\n        .then(req)\n        .catch(error => reject(error));\n      }\n\n      return req();\n    });\n\n    return promise;\n  }\n}\n\nexport default RequestFactory;\n","import RequestFactory from '../factories/request';\nimport { buildURL } from '../utils/helpers';\n\nclass BaseExtend {\n  constructor(config) {\n    this.request = new RequestFactory(config);\n\n    this.config = config;\n  }\n\n  All(token = null) {\n    const { includes, sort, limit, offset, filter } = this;\n\n    this.call = this.request.send(buildURL(this.endpoint, {\n      includes,\n      sort,\n      limit,\n      offset,\n      filter,\n    }), 'GET', undefined, token);\n\n    return this.call;\n  }\n\n  Get(id, token = null) {\n    this.call = this.request.send(buildURL(`${this.endpoint}/${id}`, {\n      includes: this.includes,\n    }), 'GET', undefined, token);\n\n    return this.call;\n  }\n\n  Limit(value) {\n    this.limit = value;\n\n    return this;\n  }\n\n  Offset(value) {\n    this.offset = value;\n\n    return this;\n  }\n\n  Sort(value) {\n    this.sort = value;\n\n    return this;\n  }\n\n  With(includes) {\n    if (includes) this.includes = includes.toString().toLowerCase();\n\n    return this;\n  }\n}\n\nexport default BaseExtend;\n","import BaseExtend from './base';\n\nclass CatalogueExtend extends BaseExtend {\n  Create(body) {\n    return this.request.send(`${this.endpoint}`, 'POST', body);\n  }\n\n  Delete(id) {\n    return this.request.send(`${this.endpoint}/${id}`, 'DELETE');\n  }\n\n  Update(id, body) {\n    return this.request.send(`${this.endpoint}/${id}`, 'PUT', body);\n  }\n}\n\nexport default CatalogueExtend;\n","import { pluralize } from 'inflected';\nimport CatalogueExtend from '../extends/catalogue';\nimport { buildRelationshipData } from '../utils/helpers';\n\nclass ProductsEndpoint extends CatalogueExtend {\n  constructor(endpoint) {\n    super(endpoint);\n\n    this.endpoint = 'products';\n  }\n\n  Filter(filter) {\n    this.filter = filter;\n\n    return this;\n  }\n\n  CreateRelationships(id, type, resources) {\n    const body = buildRelationshipData(type, resources);\n\n    return this.request.send(`${this.endpoint}/${id}/relationships/${pluralize(type)}`, 'POST', body);\n  }\n\n  DeleteRelationships(id, type, resources) {\n    const body = buildRelationshipData(type, resources);\n\n    return this.request.send(`${this.endpoint}/${id}/relationships/${pluralize(type)}`, 'DELETE', body);\n  }\n\n  UpdateRelationships(id, type, resources = null) {\n    const body = buildRelationshipData(type, resources);\n\n    return this.request.send(`${this.endpoint}/${id}/relationships/${pluralize(type)}`, 'PUT', body);\n  }\n}\n\nexport default ProductsEndpoint;\n","import BaseExtend from '../extends/base';\nimport StorageFactory from '../factories/storage';\n\nclass CurrenciesEndpoint extends BaseExtend {\n  constructor(endpoint) {\n    super(endpoint);\n\n    this.endpoint = 'currencies';\n    this.storage = new StorageFactory();\n  }\n\n  Create(body) {\n    return this.request.send(`${this.endpoint}`, 'POST', body);\n  }\n\n  Delete(id) {\n    return this.request.send(`${this.endpoint}/${id}`, 'DELETE');\n  }\n\n  Update(id, body) {\n    return this.request.send(`${this.endpoint}/${id}`, 'PUT', body);\n  }\n\n  Set(currency) {\n    const { config, storage } = this;\n\n    storage.set('mcurrency', currency);\n    config.currency = currency;\n\n    const promise = new Promise((resolve, reject) => {\n      const request = storage.get('mcurrency');\n\n      try {\n        resolve(request);\n      } catch (err) {\n        reject(new Error(err));\n      }\n    });\n\n    return promise;\n  }\n\n  Active() {\n    const storage = this.storage;\n\n    const promise = new Promise((resolve, reject) => {\n      const request = storage.get('mcurrency');\n\n      try {\n        resolve(request);\n      } catch (err) {\n        reject(new Error(err));\n      }\n    });\n\n    return promise;\n  }\n}\n\nexport default CurrenciesEndpoint;\n","import CatalogueExtend from '../extends/catalogue';\n\nclass BrandsEndpoint extends CatalogueExtend {\n  constructor(endpoint) {\n    super(endpoint);\n\n    this.endpoint = 'brands';\n  }\n}\n\nexport default BrandsEndpoint;\n","import BaseExtend from '../extends/base';\n\nimport { buildCartItemData, buildCartCheckoutData } from '../utils/helpers';\n\nclass CartEndpoint extends BaseExtend {\n  constructor(request, id) {\n    super(...arguments);\n\n    this.request = request;\n    this.cartId = id;\n    this.endpoint = 'carts';\n  }\n\n  Get() {\n    return this.request.send(`${this.endpoint}/${this.cartId}`, 'GET');\n  }\n\n  Items() {\n    return this.request.send(`${this.endpoint}/${this.cartId}/items`, 'GET');\n  }\n\n  AddProduct(productId, quantity = 1) {\n    const body = buildCartItemData(productId, quantity);\n\n    return this.request.send(`${this.endpoint}/${this.cartId}/items`, 'POST', body);\n  }\n\n  AddCustomItem(body) {\n    const itemObject = Object.assign(body, {\n      type: 'custom_item',\n    });\n\n    return this.request.send(`${this.endpoint}/${this.cartId}/items`, 'POST', itemObject);\n  }\n\n  AddPromotion(code) {\n    const body = buildCartItemData(code, null, 'promotion_item');\n\n    return this.request.send(`${this.endpoint}/${this.cartId}/items`, 'POST', body);\n  }\n\n  RemoveItem(itemId) {\n    return this.request.send(`${this.endpoint}/${this.cartId}/items/${itemId}`, 'DELETE');\n  }\n\n  UpdateItemQuantity(itemId, quantity) {\n    const body = buildCartItemData(itemId, quantity);\n\n    return this.request.send(`${this.endpoint}/${this.cartId}/items/${itemId}`, 'PUT', body);\n  }\n\n  Checkout(customer, billing_address, shipping_address = billing_address) {\n    const body = buildCartCheckoutData(customer, billing_address, shipping_address);\n\n    return this.request.send(`${this.endpoint}/${this.cartId}/checkout`, 'POST', body);\n  }\n\n  Delete() {\n    return this.request.send(`${this.endpoint}/${this.cartId}`, 'DELETE');\n  }\n}\n\nexport default CartEndpoint;\n","import CatalogueExtend from '../extends/catalogue';\n\nclass CategoriesEndpoint extends CatalogueExtend {\n  constructor(endpoint) {\n    super(endpoint);\n\n    this.endpoint = 'categories';\n  }\n\n  Tree() {\n    return this.request.send(`${this.endpoint}/tree`, 'GET');\n  }\n}\n\nexport default CategoriesEndpoint;\n","import CatalogueExtend from '../extends/catalogue';\n\nclass CollectionsEndpoint extends CatalogueExtend {\n  constructor(endpoint) {\n    super(endpoint);\n\n    this.endpoint = 'collections';\n  }\n}\n\nexport default CollectionsEndpoint;\n","import BaseExtend from '../extends/base';\n\nclass OrdersEndpoint extends BaseExtend {\n  constructor(endpoint) {\n    super(endpoint);\n\n    this.endpoint = 'orders';\n  }\n\n  Items(id) {\n    return this.request.send(`${this.endpoint}/${id}/items`, 'GET');\n  }\n\n  Payment(id, body) {\n    return this.request.send(`${this.endpoint}/${id}/payments`, 'POST', body);\n  }\n\n  Transactions(id) {\n    return this.request.send(`${this.endpoint}/${id}/transactions`, 'GET');\n  }\n}\n\nexport default OrdersEndpoint;\n","import BaseExtend from '../extends/base';\n\nclass GatewaysEndpoint extends BaseExtend {\n  constructor(endpoint) {\n    super(endpoint);\n\n    this.endpoint = 'gateways';\n  }\n\n  Update(slug, body) {\n    return this.request.send(`${this.endpoint}/${slug}`, 'PUT', body);\n  }\n\n  Enabled(slug, enabled) {\n    return this.request.send(`${this.endpoint}/${slug}`, 'PUT', {\n      type: 'gateway',\n      enabled,\n    });\n  }\n}\n\nexport default GatewaysEndpoint;\n","import BaseExtend from '../extends/base';\n\nclass CustomersEndpoint extends BaseExtend {\n  constructor(endpoint) {\n    super(endpoint);\n\n    this.endpoint = 'customers';\n  }\n\n  Create(body) {\n    return this.request.send(`${this.endpoint}`, 'POST', body);\n  }\n\n  Delete(id) {\n    return this.request.send(`${this.endpoint}/${id}`, 'DELETE');\n  }\n\n  Token(email, password) {\n    const body = {\n      type: 'token',\n      email,\n      password,\n    };\n\n    return this.request.send(`${this.endpoint}/tokens`, 'POST', body);\n  }\n\n  Update(id, body) {\n    return this.request.send(`${this.endpoint}/${id}`, 'PUT', body);\n  }\n}\nexport default CustomersEndpoint;\n","import 'fetch-everywhere';\nimport 'es6-promise';\n\nimport Config from './config';\nimport RequestFactory from './factories/request';\nimport StorageFactory from './factories/storage';\nimport ProductsEndpoint from './endpoints/products';\nimport CurrenciesEndpoint from './endpoints/currencies';\nimport BrandsEndpoint from './endpoints/brands';\nimport CartEndpoint from './endpoints/cart';\nimport CategoriesEndpoint from './endpoints/categories';\nimport CollectionsEndpoint from './endpoints/collections';\nimport OrdersEndpoint from './endpoints/orders';\nimport GatewaysEndpoint from './endpoints/gateways';\nimport CustomersEndpoint from './endpoints/customers';\n\nimport { cartIdentifier } from './utils/helpers';\n\nexport default class Moltin {\n  constructor(config) {\n    this.config = config;\n    this.cartId = cartIdentifier();\n\n    this.request = new RequestFactory(config);\n    this.storage = new StorageFactory();\n\n    this.Products = new ProductsEndpoint(config);\n    this.Currencies = new CurrenciesEndpoint(config);\n    this.Brands = new BrandsEndpoint(config);\n    this.Categories = new CategoriesEndpoint(config);\n    this.Collections = new CollectionsEndpoint(config);\n    this.Orders = new OrdersEndpoint(config);\n    this.Gateways = new GatewaysEndpoint(config);\n    this.Customers = new CustomersEndpoint(config);\n  }\n\n  // Expose `Cart` class on Moltin class\n  Cart(id = this.cartId) {\n    return new CartEndpoint(this.request, id);\n  }\n\n  // Expose `authenticate` function on the Moltin class\n  Authenticate() {\n    return this.request.authenticate();\n  }\n}\n\n// Export a function to instantiate the Moltin class\nconst gateway = config => new Moltin(new Config(config));\n\nexport { gateway };\n"],"names":["Config","options","application","client_id","client_secret","currency","host","this","protocol","version","auth","expires","uri","sdk","language","StorageFactory","localStorage","LocalStorage","require","window","set","key","value","setItem","get","getItem","delete","removeItem","rng","crypto","global","msCrypto","getRandomValues","rnds8","Uint8Array","rnds","Array","r","i","Math","random","byteToHex","toString","substr","bytesToUuid","buf","offset","bth","v4","ii","buildRelationshipData","type","ids","let","data","length","id","isArray","map","cartIdentifier","const","storage","cartId","uuidv4","parseJSON","response","status","Promise","resolve","ok","json","then","formatFilterString","filter","Object","keys","join","formatQueryString","buildQueryParams","ref","includes","sort","limit","query","include","k","buildURL","endpoint","params","buildRequestBody","body","parsedBody","JSON","stringify","buildCartItemData","quantity","payload","assign","parseInt","code","buildCartCheckoutData","customer","billing_address","shipping_address","parsedCustomer","RequestFactory","config","authenticate","Error","grant_type","promise","reject","fetch","method","headers","Content-Type","encodeURIComponent","catch","error","access_token","send","token","undefined","req","Authorization","X-MOLTIN-SDK-LANGUAGE","X-MOLTIN-SDK-VERSION","toUpperCase","Date","now","BaseExtend","request","All","call","Get","Limit","Offset","Sort","With","toLowerCase","CatalogueExtend","Create","Delete","Update","ProductsEndpoint","super","Filter","CreateRelationships","resources","pluralize","DeleteRelationships","UpdateRelationships","CurrenciesEndpoint","Set","err","Active","BrandsEndpoint","CartEndpoint","arguments","Items","AddProduct","productId","AddCustomItem","itemObject","AddPromotion","RemoveItem","itemId","UpdateItemQuantity","Checkout","CategoriesEndpoint","Tree","CollectionsEndpoint","OrdersEndpoint","Payment","Transactions","GatewaysEndpoint","slug","Enabled","enabled","CustomersEndpoint","Token","email","password","Moltin","Products","Currencies","Brands","Categories","Collections","Orders","Gateways","Customers","Cart","Authenticate","gateway"],"mappings":"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"}